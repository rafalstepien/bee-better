{% extends "habit_tracker/base.html" %}
{% block content %}
{% load custom_filters %}
<h1 class="text-center">Your habits history</h1>
<a href="{% url 'index' %}">Come back to main page</a>
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="panel panel-default col-sm-auto">
            <table class="table table-dark table-responsive table-bordered caption text-dark">
                <thead>
                    <tr>
                        {% for column_name in column_names %}
                            <th scope="col" class="text-light"> {{ column_name }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in rows %}
                    <tr>
                        {% for column_value in row %}
                            {% if forloop.counter > 1 and forloop.counter < 9 %}
                                <td onclick="updateColor(this)"></td>
                            {% else %}
                                <td class="text-light"> {{ column_value }} </td>
                            {% endif %}
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
            <script>
                function ajaxCall() {
                    var token = '{{csrf_token}}';
                    $.ajax({
                        headers: { "X-CSRFToken": token },
                        type: 'POST',
                        url: "{% url 'update_habit' %}",
                        data: 'ABCDEFG',
                        error: function() {
                            alert("Something went wrong");
                        },
                        success: function() {
                            alert("OK");
                        },
                    });
                }

                function updateColor(elem) {
                    var green="rgb(189, 233, 186)";
                    var red="rgb(245, 124, 103)";

                    if ( elem.style.backgroundColor === green) {
                        elem.style.backgroundColor = red;
                    } else {
                        elem.style.backgroundColor = green;
                    };

                    ajaxCall();
                }
            </script>
        </div>
    </div>
</div>
{% endblock content %}
